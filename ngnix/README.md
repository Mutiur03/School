# Complete Nginx Setup with SSL and Docker\n\nA comprehensive, production-ready Nginx setup with automatic SSL certificate management using Let's Encrypt, load balancing, security headers, and monitoring.\n\n## ğŸš€ Quick Start\n\n1. **Clone and Configure**\n `bash\n   cd /path/to/your/project/ngnix\n   cp .env.example .env\n   # Edit .env with your domain and email\n   `\n\n2. **Run Setup**\n `bash\n   chmod +x setup.sh manage.sh\n   ./setup.sh\n   `\n\n3. **Verify**\n `bash\n   ./manage.sh health\n   `\n\n## ğŸ“ Directory Structure\n\n`\nngnix/\nâ”œâ”€â”€ docker-compose.yml          # Docker services configuration\nâ”œâ”€â”€ .env                        # Environment variables (create from .env.example)\nâ”œâ”€â”€ .env.example               # Environment template\nâ”œâ”€â”€ setup.sh                   # Initial setup script\nâ”œâ”€â”€ manage.sh                  # Management script\nâ”œâ”€â”€ run.sh                     # Simple run script (legacy)\nâ”œâ”€â”€ nginx/\nâ”‚   â”œâ”€â”€ nginx.conf            # Main Nginx configuration\nâ”‚   â”œâ”€â”€ default.conf.template # Default server configuration\nâ”‚   â”œâ”€â”€ conf.d/               # Additional server configurations\nâ”‚   â”‚   â”œâ”€â”€ http_redirect.conf.template\nâ”‚   â”‚   â”œâ”€â”€ frontend.conf.template\nâ”‚   â”‚   â”œâ”€â”€ loadbalancer.conf.template\nâ”‚   â”‚   â””â”€â”€ production.conf.template\nâ”‚   â”œâ”€â”€ ssl/                  # Custom SSL certificates (if any)\nâ”‚   â””â”€â”€ logs/                 # Nginx log files\nâ”œâ”€â”€ certbot/\nâ”‚   â”œâ”€â”€ www/                  # Let's Encrypt challenge files\nâ”‚   â””â”€â”€ conf/                 # SSL certificates\nâ”œâ”€â”€ static/                   # Static file serving\nâ””â”€â”€ backups/                  # Configuration backups\n`\n\n## âš™ï¸ Configuration\n\n### Environment Variables (.env)\n\n| Variable | Description | Example |\n|----------|-------------|---------|\n| `DOMAIN` | Primary domain | `api.example.com` |\n| `EMAIL` | Email for Let's Encrypt | `admin@example.com` |\n| `BACKEND_HOST` | Backend server host | `host.docker.internal` |\n| `BACKEND_PORT` | Backend server port | `3002` |\n| `FRONTEND_HOST` | Frontend server host | `host.docker.internal` |\n| `FRONTEND_PORT` | Frontend server port | `3000` |\n| `ADDITIONAL_DOMAINS` | Extra domains (comma-separated) | `www.example.com,example.com` |\n| `MAX_BODY_SIZE` | Maximum request body size | `100M` |\n| `CLIENT_TIMEOUT` | Client timeout | `60s` |\n| `LOG_LEVEL` | Nginx log level | `warn` |\n\n### Server Configurations\n\nThe setup includes multiple configuration templates:\n\n- **`default.conf.template`** - Main API server with WebSocket support\n- **`frontend.conf.template`** - SPA frontend application\n- **`loadbalancer.conf.template`** - Load balancer setup\n- **`production.conf.template`** - Production-ready with enhanced security\n- **`http_redirect.conf.template`** - HTTP to HTTPS redirects\n\n## ğŸ› ï¸ Management Commands\n\nUse the `manage.sh` script for common operations:\n\n`bash\n# Start services\n./manage.sh start\n\n# Stop services\n./manage.sh stop\n\n# Restart services\n./manage.sh restart\n\n# Check status\n./manage.sh status\n\n# View logs\n./manage.sh logs\n./manage.sh logs nginx  # Specific service\n\n# SSL management\n./manage.sh ssl-renew\n./manage.sh ssl-status\n\n# Configuration\n./manage.sh test      # Test Nginx config\n./manage.sh reload    # Reload Nginx\n\n# Maintenance\n./manage.sh backup    # Backup configuration\n./manage.sh clean     # Clean Docker resources\n./manage.sh health    # Health check\n./manage.sh update    # Update images\n`\n\n## ğŸ”’ Security Features\n\n- **SSL/TLS**: Automatic Let's Encrypt certificates with auto-renewal\n- **Security Headers**: HSTS, CSP, XSS protection, etc.\n- **Rate Limiting**: API and login endpoint protection\n- **Access Control**: IP-based restrictions for admin endpoints\n- **Attack Prevention**: Blocks common exploit attempts\n- **File Security**: Prevents access to sensitive file types\n\n## ğŸ“Š Monitoring\n\n### Health Endpoints\n\n- `/health` - Application health check\n- `/nginx-status` - Nginx status (internal networks only)\n\n### Log Files\n\n- `nginx/logs/access.log` - Access logs\n- `nginx/logs/error.log` - Error logs\n- View with: `./manage.sh logs nginx`\n\n## ğŸš€ Production Deployment\n\n1. **Server Preparation**\n `bash\n   # Install Docker and Docker Compose\n   curl -fsSL https://get.docker.com -o get-docker.sh\n   sh get-docker.sh\n   \n   # Install Docker Compose\n   sudo curl -L \"https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n   sudo chmod +x /usr/local/bin/docker-compose\n   `\n\n2. **Deploy Configuration**\n `bash\n   # Upload your nginx directory to server\n   scp -r ngnix/ user@server:/path/to/deployment/\n   \n   # SSH to server\n   ssh user@server\n   cd /path/to/deployment/ngnix\n   \n   # Configure environment\n   cp .env.example .env\n   nano .env  # Set your domain, email, and backend details\n   \n   # Run setup\n   chmod +x *.sh\n   ./setup.sh\n   `\n\n3. **Verify Deployment**\n `bash\n   ./manage.sh health\n   ./manage.sh ssl-status\n   `\n\n## ğŸ”§ Customization\n\n### Adding New Server Blocks\n\n1. Create a new `.conf.template` file in `nginx/conf.d/`\n2. Use environment variables for dynamic configuration\n3. Restart services: `./manage.sh restart`\n\n### Custom SSL Certificates\n\n1. Place certificates in `nginx/ssl/`\n2. Update server blocks to use custom certificates\n3. Reload configuration: `./manage.sh reload`\n\n### Load Balancing\n\n1. Use `loadbalancer.conf.template` as a starting point\n2. Add your backend servers to the upstream block\n3. Configure health checks and failover\n\n## ğŸ†˜ Troubleshooting\n\n### Common Issues\n\n1. **SSL Certificate Failure**\n `bash\n   # Check DNS resolution\n   nslookup your-domain.com\n   \n   # Verify domain points to your server\n   dig your-domain.com\n   \n   # Check certbot logs\n   ./manage.sh logs certbot\n   `\n\n2. **Nginx Configuration Errors**\n `bash\n   # Test configuration\n   ./manage.sh test\n   \n   # Check error logs\n   ./manage.sh logs nginx\n   `\n\n3. **Backend Connection Issues**\n `bash\n   # Verify backend is running\n   curl http://localhost:3002/health\n   \n   # Check Docker network\n   docker network ls\n   docker network inspect nginx_nginx_network\n   `\n\n### Log Analysis\n\n`bash\n# Real-time monitoring\n./manage.sh logs nginx\n\n# Error analysis\ntail -f nginx/logs/error.log\n\n# Access patterns\ntail -f nginx/logs/access.log\n\n# SSL certificate debugging\n./manage.sh ssl-status\n`\n\n## ğŸ“‹ Maintenance\n\n### Regular Tasks\n\n1. **SSL Renewal** (automated, but can be manual)\n `bash\n   ./manage.sh ssl-renew\n   `\n\n2. **Backup Configuration**\n `bash\n   ./manage.sh backup\n   `\n\n3. **Update Docker Images**\n `bash\n   ./manage.sh update\n   `\n\n4. **Clean Unused Resources**\n `bash\n   ./manage.sh clean\n   `\n\n### Monitoring\n\nSet up cron jobs for regular health checks:\n\n`bash\n# Add to crontab (crontab -e)\n# Check health every 5 minutes\n*/5 * * * * cd /path/to/ngnix && ./manage.sh health >> health.log 2>&1\n\n# Backup weekly\n0 2 * * 0 cd /path/to/ngnix && ./manage.sh backup\n`\n\n## ğŸ¤ Contributing\n\nFeel free to customize and extend this setup for your specific needs. Common enhancements:\n\n- Additional security headers\n- Custom rate limiting rules\n- Application-specific proxy configurations\n- Monitoring integrations\n- Automated deployment scripts\n\n## ğŸ“„ License\n\nThis configuration is provided as-is. Use and modify according to your needs.
